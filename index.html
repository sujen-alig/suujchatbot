<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ModAPK Hub - Premium Mod APK Downloads</title>
    <link rel="stylesheet" href="style.css">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
</head>
<body>
    <!-- Supabase Configuration Section -->
    <div id="configModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h2>Supabase Configuration</h2>
                <button class="modal-close" id="closeConfig">&times;</button>
            </div>
            <div class="config-section">
                <div class="config-instructions">
                    <h3>Setup Instructions</h3>
                    <ol>
                        <li>Create a new Supabase project at <a href="https://supabase.com" target="_blank">supabase.com</a></li>
                        <li>Copy your project URL and anon key from Settings â†’ API</li>
                        <li>Run the provided SQL scripts in the SQL Editor</li>
                        <li>Configure authentication providers</li>
                        <li>Create storage buckets: apk-files, screenshots, icons</li>
                    </ol>
                </div>
                <form id="configForm">
                    <div class="form-group">
                        <label class="form-label">Supabase URL:</label>
                        <input type="url" id="supabaseUrl" class="form-control" placeholder="https://your-project.supabase.co" required>
                    </div>
                    <div class="form-group">
                        <label class="form-label">Supabase Anon Key:</label>
                        <input type="text" id="supabaseKey" class="form-control" placeholder="Your anon key" required>
                    </div>
                    <button type="submit" class="btn btn--primary">Connect to Supabase</button>
                </form>
                
                <div class="sql-scripts">
                    <h4>Database Setup SQL</h4>
                    <textarea readonly class="form-control sql-code">
-- Create APKs table
CREATE TABLE apks (
    id UUID DEFAULT gen_random_uuid() PRIMARY KEY,
    name TEXT NOT NULL,
    version TEXT NOT NULL,
    category TEXT NOT NULL,
    description TEXT NOT NULL,
    download_url TEXT NOT NULL,
    screenshot_urls TEXT[],
    icon_url TEXT,
    upload_date TIMESTAMP DEFAULT NOW(),
    download_count INTEGER DEFAULT 0,
    rating DECIMAL DEFAULT 0,
    review_count INTEGER DEFAULT 0,
    file_size TEXT,
    android_version TEXT,
    permissions TEXT[],
    verified BOOLEAN DEFAULT false,
    featured BOOLEAN DEFAULT false,
    tags TEXT[],
    created_at TIMESTAMP DEFAULT NOW(),
    updated_at TIMESTAMP DEFAULT NOW()
);

-- Create Users table
CREATE TABLE users (
    id UUID REFERENCES auth.users PRIMARY KEY,
    email TEXT,
    username TEXT UNIQUE,
    role TEXT DEFAULT 'user',
    profile_avatar TEXT,
    favorites UUID[],
    download_history UUID[],
    created_at TIMESTAMP DEFAULT NOW(),
    last_login TIMESTAMP
);

-- Create Reviews table
CREATE TABLE reviews (
    id UUID DEFAULT gen_random_uuid() PRIMARY KEY,
    apk_id UUID REFERENCES apks(id) ON DELETE CASCADE,
    user_id UUID REFERENCES users(id) ON DELETE CASCADE,
    rating INTEGER CHECK (rating >= 1 AND rating <= 5),
    comment TEXT,
    created_at TIMESTAMP DEFAULT NOW()
);

-- Enable Row Level Security
ALTER TABLE apks ENABLE ROW LEVEL SECURITY;
ALTER TABLE users ENABLE ROW LEVEL SECURITY;
ALTER TABLE reviews ENABLE ROW LEVEL SECURITY;

-- RLS Policies
CREATE POLICY "APKs are viewable by everyone" ON apks FOR SELECT USING (true);
CREATE POLICY "APKs can be inserted by admins" ON apks FOR INSERT 
    WITH CHECK (EXISTS (SELECT 1 FROM users WHERE users.id = auth.uid() AND users.role = 'admin'));
CREATE POLICY "APKs can be updated by admins" ON apks FOR UPDATE 
    USING (EXISTS (SELECT 1 FROM users WHERE users.id = auth.uid() AND users.role = 'admin'));

CREATE POLICY "Users can view their own data" ON users FOR SELECT USING (auth.uid() = id);
CREATE POLICY "Users can update their own data" ON users FOR UPDATE USING (auth.uid() = id);

CREATE POLICY "Reviews are viewable by everyone" ON reviews FOR SELECT USING (true);
CREATE POLICY "Reviews can be inserted by authenticated users" ON reviews FOR INSERT 
    WITH CHECK (auth.uid() = user_id);
                    </textarea>
                    <button type="button" class="btn btn--outline btn--sm" onclick="navigator.clipboard.writeText(document.querySelector('.sql-code').value)">
                        <i class="fas fa-copy"></i> Copy SQL
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- Header -->
    <header class="header">
        <div class="container">
            <div class="header-content">
                <div class="logo">
                    <h1><i class="fas fa-download"></i> ModAPK Hub</h1>
                    <div class="connection-status">
                        <span id="connectionStatus" class="status status--info">
                            <i class="fas fa-circle"></i> Offline
                        </span>
                    </div>
                </div>
                <nav class="nav">
                    <button id="themeToggle" class="btn btn--outline btn--sm">
                        <i class="fas fa-moon"></i>
                    </button>
                    <div id="authButtons" class="auth-buttons">
                        <button id="loginBtn" class="btn btn--outline btn--sm">
                            <i class="fas fa-sign-in-alt"></i> Login
                        </button>
                        <button id="signupBtn" class="btn btn--primary btn--sm">
                            <i class="fas fa-user-plus"></i> Sign Up
                        </button>
                    </div>
                    <div id="userMenu" class="user-menu hidden">
                        <div class="user-info">
                            <img id="userAvatar" class="user-avatar" src="" alt="User Avatar">
                            <span id="userName">User</span>
                        </div>
                        <div class="user-dropdown">
                            <button id="adminBtn" class="btn btn--outline btn--sm admin-only hidden">
                                <i class="fas fa-user-shield"></i> Admin
                            </button>
                            <button id="logoutBtn" class="btn btn--outline btn--sm">
                                <i class="fas fa-sign-out-alt"></i> Logout
                            </button>
                        </div>
                    </div>
                </nav>
            </div>
        </div>
        
        <!-- Real-time Updates Banner -->
        <div id="updatesBanner" class="updates-banner hidden">
            <div class="container">
                <div class="updates-content">
                    <i class="fas fa-sync-alt spinning"></i>
                    <span id="updatesText">Syncing data...</span>
                    <button id="dismissUpdates" class="btn btn--outline btn--sm">Dismiss</button>
                </div>
            </div>
        </div>
    </header>

    <!-- Main Content -->
    <main class="main">
        <div class="container">
            <!-- Search and Filter Section -->
            <section class="search-section">
                <div class="search-controls">
                    <div class="search-bar">
                        <i class="fas fa-search"></i>
                        <input type="text" id="searchInput" placeholder="Search for mod APKs..." class="form-control">
                        <div id="searchSuggestions" class="search-suggestions hidden"></div>
                    </div>
                    <div class="filter-controls">
                        <select id="categoryFilter" class="form-control">
                            <option value="">All Categories</option>
                        </select>
                        <select id="sortBy" class="form-control">
                            <option value="name">Sort by Name</option>
                            <option value="date">Sort by Date</option>
                            <option value="downloads">Sort by Downloads</option>
                            <option value="rating">Sort by Rating</option>
                        </select>
                    </div>
                </div>
            </section>

            <!-- APK Grid -->
            <section class="apk-grid-section">
                <div class="content-with-sidebar">
                    <!-- Sidebar -->
                    <aside class="sidebar">
                        <!-- Live Analytics -->
                        <div class="sidebar-widget">
                            <h3>Live Stats</h3>
                            <div class="live-stats">
                                <div class="live-stat">
                                    <span class="live-stat-number" id="liveDownloads">0</span>
                                    <span class="live-stat-label">Downloads Today</span>
                                </div>
                                <div class="live-stat">
                                    <span class="live-stat-number" id="activeUsers">0</span>
                                    <span class="live-stat-label">Active Users</span>
                                </div>
                            </div>
                        </div>

                        <!-- Categories -->
                        <div class="sidebar-widget">
                            <h3>Categories</h3>
                            <div id="categoriesList" class="categories-list"></div>
                        </div>
                    </aside>

                    <!-- APK Grid -->
                    <div class="apk-content">
                        <div id="loadingIndicator" class="loading-indicator">
                            <div class="spinner"></div>
                            <span>Loading APKs...</span>
                        </div>
                        <div class="apk-grid" id="apkGrid">
                            <!-- APK cards will be dynamically inserted here -->
                        </div>
                    </div>
                </div>
            </section>

            <!-- Statistics Section -->
            <section class="stats-section">
                <div class="stats-grid">
                    <div class="stat-card">
                        <i class="fas fa-download"></i>
                        <span class="stat-number" id="totalApks">0</span>
                        <span class="stat-label">Total APKs</span>
                    </div>
                    <div class="stat-card">
                        <i class="fas fa-eye"></i>
                        <span class="stat-number" id="totalDownloads">0</span>
                        <span class="stat-label">Total Downloads</span>
                    </div>
                    <div class="stat-card">
                        <i class="fas fa-users"></i>
                        <span class="stat-number" id="totalUsers">0</span>
                        <span class="stat-label">Registered Users</span>
                    </div>
                    <div class="stat-card">
                        <i class="fas fa-star"></i>
                        <span class="stat-number" id="avgRating">0.0</span>
                        <span class="stat-label">Average Rating</span>
                    </div>
                </div>
            </section>
        </div>
    </main>

    <!-- Footer -->
    <footer class="footer">
        <div class="container">
            <div class="footer-content">
                <div class="footer-section">
                    <h3>Legal Notice</h3>
                    <p>This website provides links to modified APK files. Users are responsible for ensuring legal compliance in their jurisdiction.</p>
                </div>
                <div class="footer-section">
                    <h3>DMCA</h3>
                    <p>For takedown requests, contact: <a href="mailto:admin@modapkhub.com" target="_blank">admin@modapkhub.com</a></p>
                </div>
                <div class="footer-section">
                    <h3>Disclaimer</h3>
                    <p>We do not host any files. All downloads are external links provided by users.</p>
                </div>
            </div>
            
            <div class="footer-bottom">
                <p>&copy; 2025 ModAPK Hub. All rights reserved. Powered by Supabase.</p>
            </div>
        </div>
    </footer>

    <!-- Authentication Modal -->
    <div id="authModal" class="modal hidden">
        <div class="modal-content">
            <div class="modal-header">
                <h2 id="authModalTitle">Login</h2>
                <button class="modal-close" id="closeAuth">&times;</button>
            </div>
            
            <div class="auth-section">
                <!-- Social Login -->
                <div class="social-auth">
                    <button id="googleAuth" class="btn btn--outline btn--full-width social-btn">
                        <i class="fab fa-google"></i> Continue with Google
                    </button>
                    <button id="githubAuth" class="btn btn--outline btn--full-width social-btn">
                        <i class="fab fa-github"></i> Continue with GitHub
                    </button>
                </div>
                
                <div class="auth-divider">
                    <span>or</span>
                </div>
                
                <!-- Email Auth Form -->
                <form id="authForm">
                    <div class="form-group">
                        <label class="form-label">Email:</label>
                        <input type="email" id="authEmail" class="form-control" required>
                    </div>
                    <div class="form-group">
                        <label class="form-label">Password:</label>
                        <input type="password" id="authPassword" class="form-control" required>
                    </div>
                    <div id="signupFields" class="signup-only hidden">
                        <div class="form-group">
                            <label class="form-label">Confirm Password:</label>
                            <input type="password" id="authConfirmPassword" class="form-control">
                        </div>
                        <div class="form-group">
                            <label class="form-label">Username:</label>
                            <input type="text" id="authUsername" class="form-control">
                        </div>
                    </div>
                    <button type="submit" class="btn btn--primary btn--full-width" id="authSubmitBtn">Login</button>
                </form>
                
                <div class="auth-toggle">
                    <p id="authToggleText">Don't have an account? <button type="button" id="toggleAuthMode" class="auth-link">Sign up</button></p>
                </div>
            </div>
        </div>
    </div>

    <!-- Admin Modal -->
    <div id="adminModal" class="modal hidden">
        <div class="modal-content admin-modal">
            <div class="modal-header">
                <h2>Admin Dashboard</h2>
                <button class="modal-close" id="closeAdmin">&times;</button>
            </div>
            
            <div class="admin-section">
                <div class="admin-tabs">
                    <button class="admin-tab active" data-tab="manage">Manage APKs</button>
                    <button class="admin-tab" data-tab="add">Add New APK</button>
                    <button class="admin-tab" data-tab="users">Users</button>
                    <button class="admin-tab" data-tab="analytics">Analytics</button>
                </div>

                <!-- Manage APKs Tab -->
                <div id="manageTab" class="tab-content active">
                    <h3>Manage APKs</h3>
                    <div class="admin-filters">
                        <input type="text" id="adminSearch" placeholder="Search APKs..." class="form-control">
                        <select id="adminCategoryFilter" class="form-control">
                            <option value="">All Categories</option>
                        </select>
                    </div>
                    <div id="adminApkList" class="admin-apk-list"></div>
                </div>

                <!-- Add APK Tab -->
                <div id="addTab" class="tab-content">
                    <h3>Add New APK</h3>
                    <form id="addApkForm">
                        <div class="form-row">
                            <div class="form-group">
                                <label class="form-label">App Name:</label>
                                <input type="text" id="appName" class="form-control" required>
                            </div>
                            <div class="form-group">
                                <label class="form-label">Version:</label>
                                <input type="text" id="appVersion" class="form-control" required>
                            </div>
                        </div>
                        
                        <div class="form-row">
                            <div class="form-group">
                                <label class="form-label">Category:</label>
                                <select id="appCategory" class="form-control" required>
                                    <option value="">Select Category</option>
                                </select>
                            </div>
                            <div class="form-group">
                                <label class="form-label">File Size:</label>
                                <input type="text" id="appFileSize" class="form-control" placeholder="e.g., 25.3 MB">
                            </div>
                        </div>
                        
                        <div class="form-group">
                            <label class="form-label">Description:</label>
                            <textarea id="appDescription" class="form-control" rows="3" required></textarea>
                        </div>
                        
                        <div class="form-group">
                            <label class="form-label">Download URL:</label>
                            <input type="url" id="appDownloadLink" class="form-control" required>
                        </div>
                        
                        <div class="form-row">
                            <div class="form-group">
                                <label class="form-label">Icon Upload:</label>
                                <input type="file" id="appIcon" class="form-control" accept="image/*">
                            </div>
                            <div class="form-group">
                                <label class="form-label">Screenshots:</label>
                                <input type="file" id="appScreenshots" class="form-control" accept="image/*" multiple>
                            </div>
                        </div>
                        
                        <div class="form-row">
                            <div class="form-group">
                                <label class="form-label">Android Version:</label>
                                <input type="text" id="appAndroidVersion" class="form-control" placeholder="e.g., 5.0+">
                            </div>
                            <div class="form-group">
                                <label class="form-label">Tags (comma-separated):</label>
                                <input type="text" id="appTags" class="form-control" placeholder="mod, premium, unlocked">
                            </div>
                        </div>
                        
                        <div class="form-checkboxes">
                            <label class="checkbox-label">
                                <input type="checkbox" id="appFeatured"> Featured APK
                            </label>
                            <label class="checkbox-label">
                                <input type="checkbox" id="appVerified"> Verified APK
                            </label>
                        </div>
                        
                        <div class="form-actions">
                            <button type="submit" class="btn btn--primary">
                                <i class="fas fa-plus"></i> Add APK
                            </button>
                            <button type="button" id="cancelEdit" class="btn btn--secondary hidden">Cancel Edit</button>
                        </div>
                    </form>
                </div>

                <!-- Users Tab -->
                <div id="usersTab" class="tab-content">
                    <h3>User Management</h3>
                    <div id="usersList" class="users-list"></div>
                </div>

                <!-- Analytics Tab -->
                <div id="analyticsTab" class="tab-content">
                    <h3>Live Analytics</h3>
                    <div class="analytics-grid">
                        <div class="analytics-card">
                            <h4>Real-time Activity</h4>
                            <div id="realtimeActivity" class="activity-feed"></div>
                        </div>
                        <div class="analytics-card">
                            <h4>Popular Downloads</h4>
                            <div id="popularDownloads" class="popular-list"></div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- APK Details Modal -->
    <div id="apkModal" class="modal hidden">
        <div class="modal-content">
            <div class="modal-header">
                <h2 id="apkModalTitle">APK Details</h2>
                <button class="modal-close" id="closeApkModal">&times;</button>
            </div>
            <div id="apkModalContent"></div>
        </div>
    </div>

    <!-- File Upload Progress Modal -->
    <div id="uploadModal" class="modal hidden">
        <div class="modal-content">
            <div class="modal-header">
                <h2>Uploading Files</h2>
            </div>
            <div class="upload-progress">
                <div class="progress-bar">
                    <div class="progress-fill" id="uploadProgress"></div>
                </div>
                <p id="uploadStatus">Preparing upload...</p>
            </div>
        </div>
    </div>

    <!-- Toast Notifications -->
    <div id="toastContainer" class="toast-container"></div>

    <script src="app.js"></script>
</body>
</html>